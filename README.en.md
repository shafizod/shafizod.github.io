---
permalink: /en
---

[![ru](https://img.shields.io/badge/lang-ru-red.svg)](https://shafizod.github.io)
[![en](https://img.shields.io/badge/lang-en-blue.svg)](https://shafizod.github.io/en)

## General principles of the protocol

The interaction between the Agent (hereinafter referred to as the Partner) and the System (hereinafter Alif) is built on the basis of the HTTPS protocol (RFC 2818: HTTP/1.1) in the "request-response" mode, where the initiator of the request is always the Partner, and the responder is Alif. All requests must be sent with the POST method.

Each Affiliate payment has a unique identifier, which is transmitted in each request. According to the Partner's identifier, further reconciliation of mutual settlements and resolution of disputes is carried out.

When processing a request from the Partner, Alif performs the required operation, and then sends the data and the result of the operation to the Partner as a response.

## Protocol organization

The interaction between the Partner and Alif is as follows:

1. The partner generates a request in JSON format, including the necessary data, and sends it via HTTPS to Alif at https://alifpay.tj/gate/check to check the client's account and create a payment. Alif performs client authorization and JSON parsing. In case of successful authorization, Alif performs the necessary actions and returns to the Partner a response in JSON format, including the result of the request. If the Affiliate receives a successful response ("code":200, "status":"accepted"), he may proceed to the next step (2).

2. After receiving a successful response from the Check request, you must confirm the payment by sending a request to https://alifpay.tj/gate/pay. Affiliate will proceed to the next step (3) if they receive a non-final response ("statusCode":2)

3. Upon receipt of a non-final response from the Pay request, it is necessary to send a Payment Status Check request to https://alifpay.tj/gate/post_check with an interval of 5 minutes.

4. If the Partner repeats paragraph (1) with the same data, he will receive the answer: "code":409, "status":"{payment status in Alif}". After receiving such a response, you can proceed to the next step (2) only if the payment status in Alif is "accepted".

5. If the Partner repeats paragraph (2) with the same data, he will receive a response: "code":406, "status":"{payment status in the Alifa System}". After receiving such a response, if the payment status is not final (final statuses: success, failed, canceled), go to step (3).

6. In addition to these requests, there is also an optional request to Verify the beneficiary's account at https://alifpay.tj/gate/accounts. Upon receipt of the accounts request, Alif will check for the specified service the presence of a subscriber with the specified identifier. The success indicator for this request is "code":200.

## Safety

1. The interface must accept requests from the Partner's IP addresses, which were previously transferred to Alif's technical staff.

2. userid and password - Partner's user ID and password. Are generated and transferred privately to the Partner by Alif. For the purposes of this documentation, the following data is used: userid="476a1b42-b3dc-40e9-afad-4aaae1d640b9", password="cztef62wrwcysyubbbdnhlk1rs2cztfsqgwww7j0".

3. Requests use an Authentication token (hash), which is essentially the signature of the request. This hash will be used in all requests as part of the authentication process and consists of a hashed string resulting from the application of the HMAC-SHA256 algorithm. The parameters of the algorithm are the String and password of the Partner's user.

4. The time limit for hash generation consists of the concatenation of certain fields and differs in different queries. In the explanation of the parameters of each request, the formula for concatenating this String is given.

## Requests check, pay, post_check

**Request parameters**

Parameter         | Type    | Condition     | Description
----------------- | ------- | ------------- | -----------
service           | string  | Required      | Service type. See Table #3.
userid            | string  | Required      | Partner user ID.
hash              | string  | Required      | Request signature. It is generated by the SHA256 algorithm from string concatenation: userid+account+txnid+amount.fixed(2) using the Partner's user password.
account           | string  | Required      | Credit/deposit/card/wallet/customer account numbers for replenishment.
amount            | float   | Required      | The amount of payment in the currency of the Partner or service.
currency          | string  | Required      | Currency code according to ISO 4217, for example TJS, RUB, USD, UZS, ...
txnid             | string  | Required      | Unique transaction number on the Partner's side. In check and pay requests of one payment must be the same.
phone             | string  | Required      | Phone number of the sender of the payment. This number is used for notifying the payer or for subsequent contact.
fee               | float   | Optional      | Commission from the client, which is charged by the partner.
providerId        | int     | Conditionally | Identifier of the service provider. The partner is provided with a list of available service providers. Mandatory if "service":"provider".
last_name         | string  | Conditionally | Last name of the sender. Mandatory if "service":"transfer_by_phone \| transfer_by_phone_uz \| card_humouz \| card_uzcard \| card_visa_foreign".
first_name        | string  | Conditionally | Sender name. Mandatory if "service":"transfer_by_phone \| transfer_by_phone_uz \| card_humouz \| card_uzcard \| card_visa_foreign".
middle_name       | string  | Optional      | The name of the sender.
sender_birthday   | string  | Conditionally | Date of birth of the sender in the format DD.MM.YYYY. Mandatory if "service":"transfer_by_phone \| transfer_by_phone_uz \| card_humouz \| card_uzcard".
id_series_number  | string  | Conditionally | The sender's document number. Mandatory if "service":"transfer_by_phone \| transfer_by_phone_uz".
address           | string  | Conditionally | Mandatory if "service":"card_visa_foreign".
resident_city     | string  | Conditionally | Mandatory if "service":"card_visa_foreign".
resident_country  | int     | Conditionally | Mandatory if "service":"card_visa_foreign".
postal code       | string  | Conditionally | Mandatory if "service":"card_visa_foreign".
recipient_name    | string  | Conditionally | Mandatory if "service":"card_visa_foreign".

**Response Options**

Parameter   | Type    | Condition     | Description
----------- | ------- | ------------- | -----------
id          | int     | Conditionally | Unique payment identifier on the Alif side. Mandatory if "status":"accepted".
datetime    | string  | Required      | Date and time the request was processed in RFC3339Nano format
code        | int     | Required      | Numeric response code. See Table #1
message     | string  | Required      | Description of the response code.
status      | string  | Required      | Description of the payment status.
statusCode  | int     | Required      | Status code. See Table #2.
amount      | string  | Required      | The credited amount in the currency of the service.
fx          | string  | Required      | Rate.
topay       | object  | Conditionally | Information on the user's credit lines. It is used to display information to the User and organize the User's choice of a certain loan (tranche) in the process of its payment. Each credit (tranche) has its own number and can be from 01 to 999. Mandatory if "status":"accepted", "service":"credit".
accountInfo | string  | Optional      | Information about the recipient's account.
limit       | string  | Conditionally | The rest of the client's card top-up limit. Mandatory if "service":"card \| card_all"


```markdown
// Request example #1
Method: POST
Address: https://alifpay.tj/gate/{check | pay | post_check}
Accept: application/json
content-type: application/json; charset=utf-8

{
   "service": "wallet",
   "userid": "476a1b42-b3dc-40e9-afad-4aaae1d640b9",
   "hash": "6abd8da5482f9133bbc86c48d967f9ad771057efd91c80c8d89c7fb2c917bb6f",
   "account": "992928313003",
   "amount": 18000.00,
   "currency": "RUB",
   "txnid": "29sP8k9FKBR3obJAhzHOVX7o2Gc",
   "phone": "+992935141010",
   fee: 0.15
   "providerId": 0,
   "last_name":"Ivanov",
   "first_name": "Ivan",
   "middle_name": "Ivanovich",
   "sender_birthday": "12/12/1990",
   "id_series_number": "5436271612",
   "address": "Foteh Niyozi St",
   "resident_city": "Dushanbe",
   "resident_country": 860,
   "postal_code": "734000",
   "recipient_name": "John Doe"
}

// Concatenated string to generate hash: "476a1b42-b3dc-40e9-afad-4aaae1d640b999292831300329sP8k9FKBR3obJAhzHOVX7o2Gc18000.00"

// Sample response

{
   "id": 14371303,
   "datetime": "2022-07-28T22:43:18.742486833+05:00",
   code: 200
   "message": "Ò’.Sh.",
   "status": "accepted",
   "statusCode": 0,
   "amount": "3022.20",
   "fx": "0.1679",
   "topay": null,
   "accountInfo": "{\"verified\":true}"
}


// Request example #2
Method: POST
Address: https://alifpay.tj/gate/{check | pay | post_check}
Accept: application/json
content-type: application/json; charset=utf-8

{
   "service": "provider",
   "userid": "476a1b42-b3dc-40e9-afad-4aaae1d640b9",
   "hash": "f5094d6ed0289c5dbe04d0bdc4d45fe2d753b78bffecbb6f022c5639c58f4d80",
   "account": "939145566",
   "amount": 15.05,
   "currency": "TJS",
   "txnid": "4ff79f2d-40ec-4f0a-aa18-4482b1d81bec",
   "phone": "+992935141010",
   fee: 0.15
   "providerId": 93,
   "last_name":"Ivanov",
   "first_name": "Ivan",
   "middle_name": "Ivanovich",
   "sender_birthday": "12/12/1990",
   "id_series_number": "5436271612",
   "address": "Foteh Niyozi St",
   "resident_city": "Dushanbe",
   "resident_country": 860,
   "postal_code": "734000",
   "recipient_name": "John Doe"
}

// Concatenated string to generate hash: "476a1b42-b3dc-40e9-afad-4aaae1d640b99391455664ff79f2d-40ec-4f0a-aa18-4482b1d81bec15.05"

// Sample response

{
   "id": 14371677,
   "datetime": "2022-07-28T23:01:22.624092959+05:00",
   code: 200
   "message": "Account found",
   "status": "accepted",
   "statusCode": 0,
   "amount": "15.05",
   fx: "1",
   "topay": null,
   "accountInfo": "{}"
}
```


## Query accounts

**Request parameters**

Parameter   | Type    | Condition     | Description
----------- | ------- | ------------- | -----------
service     | string  | Required      | Service type. See Table #3.
userid      | string  | Required      | Partner user ID.
hash        | string  | Required      | Request signature. It is generated by the SHA256 algorithm from string concatenation: userid+':'+datetime using the Partner's user password.
account     | string  | Required      | Credit/deposit/card/wallet/customer account numbers for replenishment.
amount      | float   | Required      | The amount of payment in the currency of the Partner or service.
currency    | string  | Required      | Currency code according to ISO 4217, for example TJS, RUB, USD, UZS, ...
providerId  | int     | Conditionally | Identifier of the service provider. The partner is provided with a list of available service providers. Mandatory if "service":"provider".
datetime    | string  | Required      | Date and time of the request in RFC 7231 format

**Response Options**

Parameter   | Type    | Condition     | Description
----------- | ------- | ------------- | -----------
code        | int     | Required      | Numeric response code. See Table #1
message     | string  | Required      | Description of the response code.
amount      | string  | Required      | The credited amount in the currency of the service.
fx          | string  | Required      | Rate.
topay       | object  | Conditionally | Information on the user's credit lines. Mandatory if "status":"accepted", "service":"credit".
accountInfo | string  | Optional      | Information about the recipient's account.


```markdown
// Request example #1
Method: POST
Address: https://alifpay.tj/gate/accounts
Accept: application/json
content-type: application/json; charset=utf-8

{
   "service": "wallet",
   "userid": "476a1b42-b3dc-40e9-afad-4aaae1d640b9",
   "hash": "e5a6f1344b3a15483d70e8d6b598b94ca08896a71f0acf9041648e12528e6009",
   "account": "992928313003",
   "amount": 18000.00,
   "currency": "RUB",
   "providerId": 0,
   "datetime": "Thu, 28 Jul 2022 23:01:22 +05"
}

// Concatenated string to generate hash: "476a1b42-b3dc-40e9-afad-4aaae1d640b9:Thu, 28 Jul 2022 23:01:22 +05"

// Sample response

{
   code: 200
   "message": "Ò’.Sh.",
   "accountInfo": "{\"verified\":true}",
   "topay": null,
   "amount": "3022.20",
   "fx": "0.1679"
}


// Request example #2
Method: POST
Address: https://alifpay.tj/gate/accounts
Accept: application/json
content-type: application/json; charset=utf-8

{
   "service": "provider",
   "userid": "476a1b42-b3dc-40e9-afad-4aaae1d640b9",
   "hash": "e5a6f1344b3a15483d70e8d6b598b94ca08896a71f0acf9041648e12528e6009",
   "account": "939145566",
   "amount": 15.05,
   "currency": "TJS",
   "providerId": 93,
   "datetime": "Thu, 28 Jul 2022 23:01:22 +05"
}

// Concatenated string to generate hash: "476a1b42-b3dc-40e9-afad-4aaae1d640b9:Thu, 28 Jul 2022 23:01:22 +05"

// Sample response

{
   code: 200
   "message": "Account found",
   "accountInfo": "{}",
   "topay": null,
   "amount": "15.05",
   "fx": "1"
}
```


**Table #1. Response codes**

Code  | Description                                | fatality  | check | pay | post_check
----- | ------------------------------------------ | --------- | ----- | --- | ----------
200   | Successfully                               | Yes       | +     | +   | +
285   | An error occurred while converting         | Yes       | +     | +   | -
286   | The exchange rate has changed              | Yes       | -     | +   | -
400   | Invalid request                            | Yes       | +     | +   | +
401   | Not authorized                             | Yes       | +     | +   | +
402   | Recipient not found                        | Yes       | +     | -   | -
403   | No access                                  | Yes       | +     | +   | +
404   | Payment not found                          | Yes       | -     | +   | +
405   | Method not allowed                         | Yes       | +     | +   | +
406   | Re-confirmation of payment                 | Yes       | -     | +   | -
409   | Re-request verification                    | Yes       | +     | -   | -
410   | Invalid recipient account                  | Yes       | +     | +   | -
411   | The amount is too small                    | Yes       | +     | -   | -
412   | The amount is too large                    | Yes       | +     | -   | -
413   | Invalid transfer amount                    | Yes       | +     | +   | -
414   | Invalid request ID                         | Yes       | +     | +   | +
415   | Client in the stop list                    | Yes       | +     | -   | -
500   | Internal Server Error                      | Yes       | +     | +   | +
503   | Temporary error. Please try again later    | No        | +     | +   | +
520   | Payment pending                            | No        | -     | +   | -
521   | Payment under review                       | No        | -     | +   | -

**Table #2. Status codes**

Code  | Status    | Description                           | Fatality
----- | --------- | ------------------------------------- | --------
0     | accepted  | Transaction accepted, payment pending | Not
1     | success   | Transaction was successful            | Yes
2     | pending   | Transaction is being processed        | Not
3     | failed    | Transaction failed                    | Yes
4     | cancelled | Transaction canceled                  | Yes

**Table No. 3. List of services**

Title                 | Description
--------------------- | -----------
wallet                | Replenishment of alif.mobi wallet
card                  | Replenishment of Korti Milli cards owned by Alif
card_all              | Replenishment of Korti Milli cards
card_humouz           | Replenishment of HumoUz cards
card_uzcard           | Replenishment of Uzkart cards
credit                | Replenishment of Alif loan
deposits              | Alif deposit replenishment
invoice               | Payment of invoices
provider              | Replenishment of service providers
emv_qr                | Payment by Emv Qr
invoice_qr            | Payment by QR
transfer_by_phone     | Transfer by phone number to Tajikistan
transfer_by_phone_uz  | Transfer by phone number to Uzbekistan
card_visa_tj          | Replenishment of Visa cards owned by Alif
card_visa_foreign     | Replenishment of Visa cards